(function(b,c){'object'==typeof exports&&'object'==typeof module?module.exports=c():'function'==typeof define&&define.amd?define([],c):'object'==typeof exports?exports.dr=c():b.dr=c()})(this,function(){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={i:d,l:!1,exports:{}};return a[d].call(e.exports,e,e.exports,b),e.l=!0,e.exports}var c={};return b.m=a,b.c=c,b.i=function(d){return d},b.d=function(d,e,f){b.o(d,e)||Object.defineProperty(d,e,{configurable:!1,enumerable:!0,get:f})},b.n=function(d){var e=d&&d.__esModule?function(){return d['default']}:function(){return d};return b.d(e,'a',e),e},b.o=function(d,e){return Object.prototype.hasOwnProperty.call(d,e)},b.p='',b(b.s=3)}([function(a){a.exports=function(){'use strict';function d(f,g,h,k){this.message=f,this.expected=g,this.found=h,this.location=k,this.name='SyntaxError','function'==typeof Error.captureStackTrace&&Error.captureStackTrace(this,d)}return function(f,g){function h(){this.constructor=f}h.prototype=g.prototype,f.prototype=new h}(d,Error),d.buildMessage=function(f,g){function h(r){return r.charCodeAt(0).toString(16).toUpperCase()}function k(r){return r.replace(/\\/g,'\\\\').replace(/"/g,'\\"').replace(/\0/g,'\\0').replace(/\t/g,'\\t').replace(/\n/g,'\\n').replace(/\r/g,'\\r').replace(/[\x00-\x0F]/g,function(t){return'\\x0'+h(t)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(t){return'\\x'+h(t)})}function l(r){return r.replace(/\\/g,'\\\\').replace(/\]/g,'\\]').replace(/\^/g,'\\^').replace(/-/g,'\\-').replace(/\0/g,'\\0').replace(/\t/g,'\\t').replace(/\n/g,'\\n').replace(/\r/g,'\\r').replace(/[\x00-\x0F]/g,function(t){return'\\x0'+h(t)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(t){return'\\x'+h(t)})}function m(r){return q[r.type](r)}var q={literal:function(r){return'"'+k(r.text)+'"'},'class':function(r){var u,t='';for(u=0;u<r.parts.length;u++)t+=r.parts[u]instanceof Array?l(r.parts[u][0])+'-'+l(r.parts[u][1]):l(r.parts[u]);return'['+(r.inverted?'^':'')+t+']'},any:function(){return'any character'},end:function(){return'end of input'},other:function(r){return r.description}};return'Expected '+function(r){var u,v,t=Array(r.length);for(u=0;u<r.length;u++)t[u]=m(r[u]);if(t.sort(),0<t.length){for(u=1,v=1;u<t.length;u++)t[u-1]!==t[u]&&(t[v]=t[u],v++);t.length=v}switch(t.length){case 1:return t[0];case 2:return t[0]+' or '+t[1];default:return t.slice(0,-1).join(', ')+', or '+t[t.length-1];}}(f)+' but '+function(r){return r?'"'+k(r)+'"':'end of input'}(g)+' found.'},{SyntaxError:d,parse:function(f,g){function h(){return f.substring(fa,ea)}function n(la,ma){return{type:'literal',text:la,ignoreCase:ma}}function o(la,ma,na){return{type:'class',parts:la,inverted:ma,ignoreCase:na}}function u(la){var na,ma=ga[la];if(ma)return ma;for(na=la-1;!ga[na];)na--;for(ma=ga[na],ma={line:ma.line,column:ma.column};na<la;)10===f.charCodeAt(na)?(ma.line++,ma.column=1):ma.column++,na++;return ga[la]=ma,ma}function v(la,ma){var na=u(la),oa=u(ma);return{start:{offset:la,line:na.line,column:na.column},end:{offset:ma,line:oa.line,column:oa.column}}}function w(la){ea<ha||(ea>ha&&(ha=ea,ia=[]),ia.push(la))}function z(){var la;return la=A(),la}function A(){var la,ma,na,oa,pa,qa;return la=ea,ma=B(),ma===H?(ea=la,la=H):(na=F(),na===H?(ea=la,la=H):(43===f.charCodeAt(ea)?(oa=K,ea++):(oa=H,w(L)),oa===H&&(45===f.charCodeAt(ea)?(oa=M,ea++):(oa=H,w(N))),oa===H?(ea=la,la=H):(pa=F(),pa===H?(ea=la,la=H):(qa=A(),qa===H?(ea=la,la=H):(fa=la,ma=O(ma,oa,qa),la=ma))))),la===H&&(la=B()),la}function B(){var la,ma,na,oa,pa,qa;return la=ea,ma=C(),ma===H?(ea=la,la=H):(na=F(),na===H?(ea=la,la=H):(42===f.charCodeAt(ea)?(oa=P,ea++):(oa=H,w(Q)),oa===H?(ea=la,la=H):(pa=F(),pa===H?(ea=la,la=H):(qa=C(),qa===H&&(qa=B()),qa===H?(ea=la,la=H):(fa=la,ma=R(ma,qa),la=ma))))),la===H&&(la=C()),la}function C(){var la,ma,na,oa,pa,qa;return la=ea,40===f.charCodeAt(ea)?(ma=S,ea++):(ma=H,w(T)),ma===H?(ea=la,la=H):(na=F(),na===H?(ea=la,la=H):(oa=A(),oa===H?(ea=la,la=H):(pa=F(),pa===H?(ea=la,la=H):(41===f.charCodeAt(ea)?(qa=U,ea++):(qa=H,w(V)),qa===H?(ea=la,la=H):(fa=la,ma=W(oa),la=ma))))),la===H&&(la=D()),la}function D(){var la,ma,na,oa;return la=ea,ma=G(),ma===H?(ea=la,la=H):(100===f.charCodeAt(ea)?(na=X,ea++):(na=H,w(Y)),na===H?(ea=la,la=H):(oa=G(),oa===H?(ea=la,la=H):(fa=la,ma=Z(ma,oa),la=ma))),la===H&&(la=E()),la}function E(){var la,ma;return la=ea,ma=G(),ma!==H&&(fa=la,ma=$(ma)),la=ma,la}function F(){var la,ma;for(la=[],_.test(f.charAt(ea))?(ma=f.charAt(ea),ea++):(ma=H,w(aa));ma!==H;)la.push(ma),_.test(f.charAt(ea))?(ma=f.charAt(ea),ea++):(ma=H,w(aa));return la}function G(){var la,ma,na;if(la=ea,ma=[],ba.test(f.charAt(ea))?(na=f.charAt(ea),ea++):(na=H,w(ca)),na!==H)for(;na!==H;)ma.push(na),ba.test(f.charAt(ea))?(na=f.charAt(ea),ea++):(na=H,w(ca));else ma=H;return ma!==H&&(fa=la,ma=da()),la=ma,la}g=void 0===g?{}:g;var ka,H={},I={Expression:z},J=z,K='+',L=n('+',!1),M='-',N=n('-',!1),O=function(la,ma,na){return{type:'sum',operator:ma,left:la,right:na}},P='*',Q=n('*',!1),R=function(la,ma){return{type:'product',left:la,right:ma}},S='(',T=n('(',!1),U=')',V=n(')',!1),W=function(la){return{type:'group',argument:la}},X='d',Y=n('d',!1),Z=function(la,ma){return{type:'roll',count:la,value:ma}},$=function(la){return{type:'static',value:la}},_=/^[\t\r\n ]/,aa=o(['\t','\r','\n',' '],!1,!1),ba=/^[0-9]/,ca=o([['0','9']],!1,!1),da=function(){return parseInt(h())},ea=0,fa=0,ga=[{line:1,column:1}],ha=0,ia=[];if('startRule'in g){if(!(g.startRule in I))throw new Error('Can\'t start parsing from rule "'+g.startRule+'".');J=I[g.startRule]}if(ka=J(),ka!==H&&ea===f.length)return ka;throw ka!==H&&ea<f.length&&w(function(){return{type:'end'}}()),function(la,ma,na){return new d(d.buildMessage(la,ma),la,ma,na)}(ia,ha<f.length?f.charAt(ha):null,ha<f.length?v(ha,ha+1):v(ha,ha))}}}()},function(a){let c={toString(d){return'extended'===d?`${this.extended} = ${this.value}`:`${this.text} = ${this.value}`},valueOf(){return this.value}};a.exports=function d(e){switch(e.type){case'static':return Object.assign(Object.create(c),{extended:e.value.toString(),text:e.value.toString(),value:e.value});case'group':let f=d(e.argument);return Object.assign(Object.create(c),{extended:`(${f.extended})`,text:`(${f.text})`,value:f.value});case'sum':case'product':let g=d(e.left),h=d(e.right),k='sum'===e.type?e.operator:'*';return Object.assign(Object.create(c),{extended:`${g.extended} ${k} ${h.extended}`,text:`${g.text} ${k} ${h.text}`,value:'+'===k?g.value+h.value:'-'===k?g.value-h.value:'*'===k?g.value*h.value:''});case'roll':let m,l=0,n=[];for(let o=0;o<e.count;o++)m=Math.floor(Math.random()*e.value)+1,n.push(m),l+=m;return Object.assign(Object.create(c),{extended:1<n.length?`(${n.join(' + ')})`:l.toString(),text:l.toString(),value:l});}}},function(a,b,c){a.exports=(d)=>c(1)(c(0).parse(d))},function(a,b,c){a.exports={evaluate:c(1),parser:c(0),roll:c(2)}}])});